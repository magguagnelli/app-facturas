{% extends "base.html" %}
{% block title %}Alta CFDI{% endblock %}

{% block head %}
<link rel="stylesheet" href="/static/css/cfdi.css">
{% endblock %}

{% block content %}

<div class="row w-100"></div>
<div class="au_container">
  <div class="au_header">
    <div>
      <h3 class="au_title verde_t">ALTA de CFDI</h3>
      <div class="au_subtitle">Sube XML → Validar (XML/XSD/RFC) → Llenar datos Obligatorios y/o Opcionales  → Capturar CFDI </div>
    </div>
    <div class="au_actions">
      <a class="au_btn au_btn_secondary" href="/cfdi">← Volver</a>
    </div>
  </div>

  <div class="au_panel">
    <div class="au_checklist">
      <div class="au_check" id="au_ck_xml">XML: —</div>
      <div class="au_check" id="au_ck_xsd">XSD: —</div>
      <div class="au_check" id="au_ck_timbre">Timbre: —</div>
      <div class="au_check" id="au_ck_rfc">RFC catálogo: —</div>
    </div>
    <div class="row w-20"></div>
    <div class="au_grid">
      <div>
        <label class="au_label">Archivo XML CFDI</label>
        <input class="au_input_xml" id="au_file" type="file" accept=".xml">&nbsp;
        <button class="au_btn" id="au_btnValidar">Validar</button>
      </div>
      <div>
        <div id="au_val_msgs" class="au_panel au_panel_inner" style="margin-top:10px; display:none;">
          <div class="au_muted"><b>Detalle de validación</b></div>
          <ul id="au_val_list" class="au_ul"></ul>
        </div>
      </div>    
    </div>
  </div>

  <div class="au_panel au-panel-form" id="au_formBox" style="margin-top:14px; display:none;">
    <h4 class="au_h4 verde_t">Nota: Los campos con * son obligatorios</h4>
    <form id="au_altaForm" class="au_form">
      <div class="au_grid">
        <div class="au_form_actions">
          <button class="au_btn" type="submit">Registrar CFDI</button>
        </div>
      </div>
      <div id="au_altaMsg" class="au_muted"></div>
      <div class="row w-20"></div>
      
      <!--Tabs de formulario-->
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="contrato-tab" data-bs-toggle="tab" data-bs-target="#contrato" type="button" role="tab" aria-controls="home" aria-selected="true">
            Información Contrato
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="cfdi-tab" data-bs-toggle="tab" data-bs-target="#cfdi" type="button" role="tab" aria-controls="cfdi" aria-selected="false">
            Información del CFDI
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="adicionales-tab" data-bs-toggle="tab" data-bs-target="#adicionales" type="button" role="tab" aria-controls="adicionales" aria-selected="false">
            Información Complementaria
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="facturacion-tab" data-bs-toggle="tab" data-bs-target="#facturacion" type="button" role="tab" aria-controls="facturacion" aria-selected="false">
            Facturación
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="devolucion-tab" data-bs-toggle="tab" data-bs-target="#devolucion" type="button" role="tab" aria-controls="devolucion" aria-selected="false">
            Devolución
          </button>
        </li>
      </ul>
      <div class="row w-20"></div>
      <!--contrato-->
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="contrato" role="tabpanel" aria-labelledby="contrato-tab">
          <div class="au_grid">
            <div>
              <label class="au_label">Contrato*</label>
              <select class="au_input" id="au_contrato"></select>
            </div>
            <div>
              <label class="au_label">Tipo de contrato</label>
              <input class="au_input" id="au_tipo_contrato" readonly>
            </div>
            <div>
              <label class="au_label">Partida*</label>
              <select class="au_input" id="au_partida"></select>
            </div>
            <div>
              <label class="au_label">Mes servicio*</label>
              <select class="au_input" id="au_mes_servicio">
                <option value="ENERO">ENERO</option>
                <option value="FEBRERO">FEBRERO</option>
                <option value="MARZO">MARZO</option>
                <option value="ABRIL">ABRIL</option>
                <option value="MAYO">MAYO</option>
                <option value="JUNIO">JUNIO</option>
                <option value="JULIO">JULIO</option>
                <option value="AGOSTO">AGOSTO</option>
                <option value="SEPTIEMBRE">SEPTIEMBRE</option>
                <option value="OCTUBRE">OCTUBRE</option>
                <option value="NOVIEMBRE">NOVIEMBRE</option>
                <option value="DICIEMBRE">DICIEMBRE</option>
              </select>
            </div>
            <div><label class="au_label">Estatus Administrativo*</label><select class="au_input" id="au_estatus_os" ></select></div>
            <div>
              <label class="au_label">Fecha de captura</label>
              <input class="au_input" id="au_fecha_captura" type="date" readonly>
            </div>
            <div>
              <label class="au_label">RFC Emisor</label>
              <input class="au_input" id="au_proveedor_rfc" readonly>
              <input type="hidden" id="au_proveedor_id">
            </div>
            <div>
              <label class="au_label">Razón Social</label>
              <input class="au_input" id="au_razon" readonly>
            </div>
            <div>
              <label class="au_label">Capturista</label>
              <input class="au_input" id="au_capturista" value="{{user_name}}" readonly>
              <input class="au_input" id="au_correo" value="{{user_mail}}" type="hidden" readonly>
            </div>
          </div>
        </div>
      <!--CFDI-->
        <div class="tab-pane fade" id="cfdi" role="tabpanel" aria-labelledby="cfdi-tab">
          <div class="au_grid">
            <div>
              <label class="au_label">Folio Fiscal (UUID)</label>
              <input class="au_input" id="au_uuid" type="text" readonly>
            </div>
            <div>
              <label class="au_label">Fecha factura</label>
              <input class="au_input" id="au_fecha_factura" type="text" readonly>
            </div>
            <div>
              <label class="au_label">Monto sin IVA (MNX)</label>
              <input class="au_input" id="au_monto_siniva" readonly>
            </div>
            <div>
              <label class="au_label">IVA (MNX)</label>
              <input class="au_input" id="au_iva" readonly>
            </div>
            <div>
              <label class="au_label">Monto con IVA (MNX)</label>
              <input class="au_input" id="au_monto_c_iva" readonly>
            </div>
            <div><label class="au_label">ISR (MNX)</label><input class="au_input" id="au_isr"  readonly></div>
            <div>
                <label class="au_label">Monto de la partida*</label>
                <input class="au_input" id="au_monto_partida" >
                <label class="au_label">Si la factura no es multipartida, debe ingresar el Monto con IVA</label>
            </div>
            <div><label class="au_label">IEPS (MNX)</label><input class="au_input" id="au_ieps" value="0"></div>
            <div><label class="au_label">Descuento (MNX)</label><input class="au_input" id="au_descuento"  value="0" ></div>
            <div><label class="au_label">Otras contribuciones (MNX)</label><input class="au_input" id="au_otras"  value="0"></div>
            <div><label class="au_label">Retenciones (MNX)</label><input class="au_input" id="au_retenciones"  value="0" ></div>
            <div><label class="au_label">Retención de Impuesto sobre Nómina (MNX)</label><input class="au_input" id="au_ret_imp_nom"  value="0" ></div>
            <div><label class="au_label">Penalización (MNX)</label><input class="au_input" id="au_penalizacion"  value="0" ></div>
            <div><label class="au_label">Deductiva (MNX)</label><input class="au_input" id="au_deductiva"  value="0" ></div>
            <div>
              <label class="au_label">Importe pago (MNX)</label>
                <input class="au_input" id="au_importe_pago" >
            </div>
            <div><label class="au_label">Importe p/compromiso</label><input class="au_input" id="au_importe_comp" ></div>
          </div>
          <div style="margin-top:10px;">
              <label class="au_label">Observaciones CFDI</label>
              <textarea class="au_input" id="au_obs_cfdi" rows="2"></textarea>
          </div>
        </div>
        <div class="tab-pane fade" id="adicionales" role="tabpanel" aria-labelledby="adicionales-tab">
          <div class="au_grid">
            <div><label class="au_label">Orden de suministro</label><input class="au_input" id="au_orden_suministro" ></div>
            <div><label class="au_label">Fecha solicitud</label><input class="au_input" id="au_fecha_orden" type="date" ></div>
            <div><label class="au_label">Folio oficio</label><input class="au_input" id="au_folio_oficio" maxlength="20" ></div>
            <div><label class="au_label">Folio interno</label><input class="au_input" id="au_folio_interno" maxlength="20"></div>
            <div><label class="au_label">Cuenta bancaria</label><input class="au_input" id="au_cuenta_bancaria" maxlength="30"></div>
            <div><label class="au_label">Banco</label><input class="au_input" id="au_banco" maxlength="20" ></div>
            <div><label class="au_label">No. compromiso</label><input class="au_input" id="au_no_comp" type="number" ></div>            
            <!--restantes-->
            <div><label class="au_label">Validación</label><input class="au_input" id="au_validacion"  ></div>
            <div><label class="au_label">5 millar</label><input class="au_input" id="au_5millar"  ></div>
            <div><label class="au_label">r iva</label><input class="au_input" id="au_riva"  ></div>
            <div><label class="au_label">r isr</label><input class="au_input" id="au_risr"  ></div>
            <div><label class="au_label">Solicitud</label><input class="au_input" id="au_solicitud"  ></div>
            <!--finales-->
            <div><label class="au_label">Fecha Pago Referenciado</label><input class="au_input" id="au_fecha_pr" type="date" ></div>
            <div><label class="au_label">Inmueble</label><input class="au_input" id="au_inmueble" ></div>
            <div><label class="au_label">Periodo</label><input class="au_input" id="au_periodo" ></div>
            <div><label class="au_label">Recargos</label><input class="au_input" id="au_recargos" ></div>
            <div><label class="au_label">Corte Presupuesto</label><input class="au_input" id="au_corte_presupuesto" ></div>
            <div><label class="au_label">Fecha de Turno</label><input class="au_input" id="au_fecha_turno" type="date"></div>
          </div>
          <div><input class="au_input" id="au_archivo" maxlength="100" type="hidden"></div>
          <div style="margin-top:10px;">
            <label class="au_label">Observaciones de Pago referenciado</label>
            <textarea class="au_input" id="au_obs_pr" rows="2"></textarea>
          </div>
          <div style="margin-top:10px;">
            <label class="au_label">Observaciones</label>
            <textarea class="au_input" id="au_obs_os" rows="2"></textarea>
          </div>
        </div>
        <div class="tab-pane fade" id="facturacion" role="tabpanel" aria-labelledby="facturacion-tab">
          <div class="au_grid">
            <div><label class="au_label">Fecha de Fiscalización</label><input class="au_input" id="au_fecha_fiscalizacion" type="date" ></div>
            <div>
              <label class="au_label">Fiscalizador</label>
              <select class="au_input" id="au_fiscalizador" >
                {% for fisc in fiscalizadores["items"] %}
                  <option value="{{ fisc['fiscalizador'] }}">{{ fisc["fiscalizador"] }}</option>
                {% endfor %}
              </select>
            </div>
            <div><label class="au_label">Responsable DOC FIS</label><input class="au_input" id="au_responsable_fis"></div>
            <div><label class="au_label">Fecha de Carga en SICOP</label><input class="au_input" id="au_fecha_carga_sicop" type="date"></div>
            <div><label class="au_label">Responsable de carga en SICOP</label><input class="au_input" id="au_responsable_carga_sicop" ></div>
            <div><label class="au_label">Estatus SIAF</label>
              <select class="au_input" id="au_estatus_siaf" name="au_estatus_siaf">
                    {% for siaf in estados_siaf["items"] %}
                        <option value="{{ siaf['estado_siaf'] }}">{{ siaf["estado_siaf"] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div><label class="au_label">CLC 2024</label><input class="au_input" id="au_clc" ></div>
            <div><label class="au_label">Número de Solicitud de Pago 2024</label><input class="au_input" id="au_numero_solicitud_pago" ></div>
            <div><label class="au_label">CLC 2025</label><input class="au_input" id="au_clc25" ></div>
            <div><label class="au_label">Número de Solicitud de Pago 2025</label><input class="au_input" id="au_numero_solicitud_pago25" ></div>
            <div><label class="au_label">CLC 2026</label><input class="au_input" id="au_clc26" ></div>
            <div><label class="au_label">Número de Solicitud de Pago 2026</label><input class="au_input" id="au_numero_solicitud_pago26" ></div>
            <div><label class="au_label">CLC 2027</label><input class="au_input" id="au_clc27" ></div>
            <div><label class="au_label">Número de Solicitud de Pago 2027</label><input class="au_input" id="au_numero_solicitud_pago27" ></div>
            <div><label class="au_label">Fecha pago</label><input class="au_input" id="au_fecha_pago" type="date"></div>
          </div>
        </div>
        <div class="tab-pane fade" id="devolucion" role="tabpanel" aria-labelledby="devolucion-tab">
          <div class="au_grid">
            <div><label class="au_label">Oficio Devolución</label><input class="au_input" id="au_oficio_dev" ></div>
            <div><label class="au_label">Fecha de Devolución</label><input class="au_input" id="au_fecha_dev" type="date" ></div>
          </div>
          <div><label class="au_label">Motivo de Devolución</label><textarea class="au_input" id="au_motivo_dev" rows="4" ></textarea></div>
        </div>
      </div>
    </form>
  </div>
</div>

<script src="/static/js/cfdi.js"></script>
{% endblock %}